{ inputs, pkgs, lib, config, ... }:

let
  cfg = config.pentesting;
  web = cfg.webapp;
  brf = cfg.bruteForce;
  sre = cfg.reverseEngineering;
in {
  options = {
    pentesting = {
      enable = lib.mkEnableOption "pentesting tools";

      metasploit.enable = lib.mkEnableOption "Metasploit framework";

      webapp = {
        enable = lib.mkEnableOption "Web App suite";

        zap.enable = lib.mkOption {
          description = "Whether to enable OWASP ZAP proxy";
          type = lib.types.bool;
          default = true;
        };

        nuclei.enable = lib.mkOption {
          description = "Whether to enable Nuclei web vulnerability scanner";
          type = lib.types.bool;
          default = true;
        };

        katana.enable = lib.mkOption {
          description = "Whether to enable Katana web crawler";
          type = lib.types.bool;
          default = true;
        };

        feroxbuster.enable = lib.mkOption {
          description = "Whether to enable Feroxbuster";
          type = lib.types.bool;
          default = true;
        };
      };

      bruteForce = {
        enable = lib.mkEnableOption "Brute Forcing suite";

        hashcat.enable = lib.mkOption {
          description = "Whether to enable hashcat password recovery";
          type = lib.types.bool;
          default = true;
        };
      };

      reverseEngineering = {
        enable = lib.mkEnableOption "Reverse Engineering suite";

        ghidra.enable = lib.mkOption {
          description = "Whether to enable Ghidra SRE suite";
          type = lib.types.bool;
          default = true;
        };
      };
    };
  };

  config = lib.mkIf cfg.enable {
    home.packages = 
      lib.lists.optionals cfg.metasploit.enable [ pkgs.metasploit ] ++
      lib.lists.optionals cfg.webapp.enable (
        lib.lists.optionals web.zap.enable [ pkgs.zap ] ++
        lib.lists.optionals web.nuclei.enable [ pkgs.nuclei ] ++
        lib.lists.optionals web.feroxbuster.enable [ pkgs.feroxbuster ] ++
        lib.lists.optionals web.katana.enable [ pkgs.katana ]
      ) ++
      lib.lists.optionals cfg.bruteForce.enable (
        lib.lists.optionals brf.hashcat.enable [ pkgs.hashcat ]
      ) ++
      lib.lists.optionals cfg.reverseEngineering.enable (
        lib.lists.optionals sre.ghidra.enable [ pkgs.ghidra ]
      );
  };
}
